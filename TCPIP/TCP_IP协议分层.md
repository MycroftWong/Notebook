# TCP/IP协议分层

## 传输层

作用：进行建立连接和断开连接的处理，在两个主机之间创建逻辑上的通信连接。此外，传输层为确保所传输的数据到达目标地址，会在通信两端的计算机之间进行确认，如果数据没有到达，它会负责进行重发。

## 网络层

作用：在网络与网络相互连接的环境中，将数据从发送端主机发送到接收端主机。

### 路由控制

路由控制（Routing）是指将分组数据发送到最终目标地址的功能。

而将分组数据发送到最终目标地址的过程可能会使用到多跳路由，同时因为所有主机都维护这一张路由控制表，数据能够合理正确地发送到最终目标地址。

### IP地址

IP地址用于在“连接到网络中的所有主机中识别出进行通信的目标地址”。

IP地址分为A/B/C/D类，A/B/C三类都是一个区间地址，它规定的是网络号，并不是指一个地址。我们在使用的时候，得到的不仅仅是网络号，还有主机号。

### DNS

使用域名代替IP与主机进行通信。

关键字：

- IP地址不便记忆
- 域名：根域名、顶级域名，域名服务器

### ARP

ARP是一种解决地址问题的协议。以目标IP地址为线索，用来定位下一个应该接收数据分包的网络设备对应的MAC地址。如果目标主机不再同一链路上时，可以通过ARP查找下一跳路由器的MAC地址。

关键字：

- ARP请求、ARP响应
- IP地址和MAC地址缺一不可？数据使用会在链路层中传输，故必须有MAC地址；如果只有MAC地址，那么在地址巡查表中的数据会无限膨胀。
- RARP
- 代理ARP

### ICMP

确认网络是否正常，以及遇到异常时进行问题巡查。ICMP的主要功能包括，确认IP包是否成功送达目标地址，通知在发送过程中IP包被废弃的具体原因，改善网络设置等。

关键字：

- 发送ARP请求包，返回ICMP包
- Destination Unreachable 目标不可达
- Network Unreachable 网络不可达

### DHCP

Dynamic Host Configuration Protocol: 实现自动设置IP地址、统一管理IP地址分配。

关键字：

- 即插即用
- DHCP服务器：在分配IP底之前发送ICMP会送请求包，确认没有返回应答
- DHCP客户端：针对从DHCP那里获得的IP地址发送ARP请求包，确认没有返回应答。
- DHCP中继代理

### NAT

Network Address Translator(网络地址转换器): 是用于在本地网络中使用私有地址，在连接互联网是转而使用全局IP地址的技术。除了转换IP地址外，还出现了可以转换TCP、UDP端口号的NAPT（Network Address Ports Translator）技术，由此可以实现一个全局IP地址与多个主机的通信。

关键字：

- NAT, NAPT
- NAT-PT, NAPT-PT
- NAT的潜在问题：无法从NAT的外部向内部服务器进行连接；转换表的生辰关于转换操作都会产生一定的开销
- NAT穿越

### IP隧道

## 数据链路层

通信传输实际上是通过物理的传输介质实现的。数据链路层的作用就是在这些通过传输介质互联的设备之间进行数据处理。

### 网络层与数据链路层

网络层与数据链路层都是基于目标地址将数据发送给接收端的，但是网络层负责将整个数据发送给最终目标地址，而数据链路层则只负责发送一个分段内的数据。

数据链路层的主要作用是在互联同一种数据链路的节点之间进行包传递。而一旦跨越多种数据链路，就需要借助网络层。网络层可以跨越不同的数据链路，即使是在不同的数据链路上也能实现两端节点之间的数据包传输。

